@using MudBlazor.State

@inherits ComponentBaseWithState

<MudText Class="mb-4">Current count: @_counterState.Value</MudText>

<MudButton Color="Color.Primary" Variant="Variant.Filled" @onclick="() => IncrementCount(1)">Click me</MudButton>

@code {
    [Parameter]
    public int InitialCount { get; set; }

    [Parameter]
    public EventCallback<int> InitialCountChanged { get; set; }

    private readonly ParameterState<int> _counterState;

    public Counter()
    {
        using var registerScope = CreateRegisterScope();

        _counterState = registerScope.RegisterParameter<int>(nameof(InitialCount))
                                     .WithParameter(() => InitialCount)
                                     .WithEventCallback(() => InitialCountChanged)
                                     .WithChangeHandler(ChangeHandler);
    }

    private void ChangeHandler(ParameterChangedEventArgs<int> args)
    {
        _counterState?.SetValueAsync(args.Value);
    }

    private void IncrementCount(int count)
    {
        _counterState?.SetValueAsync(_counterState.Value + count);
    }
}